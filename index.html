<!Doctype: HTML w/ Processing>

<html>

  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Processing Demo</title>
      <script type="text/javascript" src="js/processing.js"></script>
  </head>
  
  <body>
    <h1>PUT YOUR TITLE HERE</h1>
    <p>ADD DESCRIPTION HERE</p>
    
    <script type="text/processing">
    
      let img;
      let hexCenters = []; // Центры групп шестиугольников
      let imageLoaded = false;
      let hexWidth = 80; // Ширина шестиугольника
      let hexHeight = 60; // Высота шестиугольника
      let trans = 80; // Прозрачность шестиугольника
      
      let hexLayer; // Слой для отрисовки шестиугольников
      
      function setup() {
        createCanvas(1200, 800);
      
        // Инициализируем слой для шестиугольников
        hexLayer = createGraphics(width, height);
        hexLayer.clear();
      }
      
      function draw() {
        background(255);
      
        // Отображаем изображение, если оно загружено
        if (imageLoaded) {
          image(img, 0, 0);
        }
      
        // Отображаем слой с шестиугольниками
        image(hexLayer, 0, 0);
      
        // Рисуем кнопку для выбора изображения
        drawButton();
      }
      
      function drawButton() {
        fill(200);
        stroke(0);
        rect(10, 10, 120, 30);
        fill(0);
        textSize(16);
        textAlign(CENTER, CENTER);
        text("Выбрать фото", 70, 25);
      }
      
      function mousePressed() {
        if (imageLoaded && mouseButton === LEFT && !isMouseOverButton()) {
          hexCenters.push(createVector(mouseX, mouseY));
          updateHexLayer();
        } else if (mouseButton === RIGHT) {
          for (let i = hexCenters.length - 1; i >= 0; i--) {
            let center = hexCenters[i];
            if (dist(mouseX, mouseY, center.x, center.y) < hexWidth / 2) {
              hexCenters.splice(i, 1);
              updateHexLayer();
              break;
            }
          }
        } else if (isMouseOverButton()) {
          selectImage();
        }
      }
      
      function updateHexLayer() {
        hexLayer.clear();
        for (let center of hexCenters) {
          drawHexagonGroup(hexLayer, center.x, center.y);
        }
      }
      
      function drawHexagonGroup(layer, x, y) {
        layer.push();
        layer.translate(x, y);
      
        drawHexagon(layer, 0, 0, hexWidth, hexHeight, trans);
      
        let horizontalOffset = hexWidth * 0.435;
        let verticalOffset = hexHeight * 0.75;
      
        drawHexagon(layer, -horizontalOffset, -verticalOffset, hexWidth, hexHeight, trans);
        drawHexagon(layer, horizontalOffset, -verticalOffset, hexWidth, hexHeight, trans);
        drawHexagon(layer, -horizontalOffset, verticalOffset, hexWidth, hexHeight, trans);
        drawHexagon(layer, horizontalOffset, verticalOffset, hexWidth, hexHeight, trans);
        drawHexagon(layer, -horizontalOffset * 2, 0, hexWidth, hexHeight, trans);
        drawHexagon(layer, horizontalOffset * 2, 0, hexWidth, hexHeight, trans);
      
        layer.pop();
      }
      
      function drawHexagon(layer, x, y, width, height, alpha) {
        layer.fill(255, 0, 0, alpha);
        layer.noStroke();
        layer.beginShape();
        for (let i = 0; i < 6; i++) {
          let angle = PI / 3 * i - PI / 6;
          let px = x + cos(angle) * (width / 2);
          let py = y + sin(angle) * (height / 2);
          layer.vertex(px, py);
        }
        layer.endShape(CLOSE);
      }
      
      // Функция для выбора изображения
      function selectImage() {
        const input = createFileInput(handleFile);
        input.position(10, 10); // Позиция элемента выбора файла
      }
      
      // Обработчик выбора изображения
      function handleFile(file) {
        if (file.type === 'image') {
          img = createImg(file.data, ''); // Создаем изображение
          img.hide(); // Скрываем оригинальное изображение
          imageLoaded = true;
          console.log("Изображение загружено: " + file.name);
        } else {
          console.log("Выбранный файл не является изображением.");
        }
      }
      
      // Проверка, находится ли курсор над кнопкой
      function isMouseOverButton() {
        return mouseX >= 10 && mouseX <= 130 && mouseY >= 10 && mouseY <= 40;
      }

    </script>
    <canvas id="sketch" style="border: 1px solid black;"></canvas>
    
  </body>
  
</html>
